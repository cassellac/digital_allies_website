(function(){const s={open:!1,lang:document.documentElement.lang?.startsWith('es')?'es':'en',faqs:[]};const b=document.createElement('button');b.className='da-chat-button';b.type='button';b.setAttribute('aria-haspopup','dialog');b.setAttribute('aria-expanded','false');b.textContent=s.lang==='es'?'Chat de ayuda':'Help Chat';const p=document.createElement('div');p.className='da-chat-panel';p.setAttribute('role','dialog');p.setAttribute('aria-modal','true');p.setAttribute('hidden','');p.innerHTML=`<div class="da-chat-header"><span>${s.lang==='es'?'Asistente de Digital Allies':'Digital Allies Assistant'}</span><div><button type="button" data-lang="en" aria-label="English">EN</button><button type="button" data-lang="es" aria-label="Español">ES</button><button type="button" data-close aria-label="${s.lang==='es'?'Cerrar':'Close'}">✕</button></div></div><div class="da-chat-body" id="da-body"></div><form class="da-search" id="da-form"><input id="da-q" type="search" placeholder="${s.lang==='es'?'Busca una pregunta…':'Search a question…'}" aria-label="${s.lang==='es'?'Buscar':'Search'}"/><button>${s.lang==='es'?'Buscar':'Search'}</button></form>`;document.addEventListener('DOMContentLoaded',()=>{document.body.appendChild(b);document.body.appendChild(p);l(s.lang);b.addEventListener('click',t);p.querySelector('[data-close]').addEventListener('click',t);p.addEventListener('keydown',e=>{if(e.key==='Escape')t(!1)});p.querySelectorAll('button[data-lang]').forEach(d=>d.addEventListener('click',()=>L(d.dataset.lang)));p.querySelector('#da-form').addEventListener('submit',y)});function t(f){s.open=f!=null?f:!s.open;p.toggleAttribute('hidden',!s.open);b.setAttribute('aria-expanded',String(s.open));if(s.open){p.querySelector('#da-q').focus()}else{b.focus()}}async function l(f){s.lang=f;const r=await fetch(`chatbot/faq.${f}.json`,{cache:'no-store'});s.faqs=(await r.json()).faqs||[];o(s.faqs.slice(0,6));b.textContent=f==='es'?'Chat de ayuda':'Help Chat';p.querySelector('#da-q').setAttribute('placeholder',f==='es'?'Busca una pregunta…':'Search a question…')}function o(f){const r=p.querySelector('#da-body');r.innerHTML='';if(!f.length){r.innerHTML=`<p class="da-msg">${s.lang==='es'?'Sin resultados. Intenta con otras palabras.':'No results. Try different keywords.'}</p>`;return}f.forEach(({q,a})=>{const e=document.createElement('div');e.className='da-msg q';e.textContent=q;r.appendChild(e);const n=document.createElement('div');n.className='da-msg a';n.textContent=a;r.appendChild(n)});const e=document.createElement('div');e.className='da-msg';e.innerHTML=s.lang==='es'?'¿Aún tienes dudas? Escríbenos a <a href="mailto:contact@digitalallies.net">contact@digitalallies.net</a> o llama al <a href="tel:+19282285769">928-228-5769</a>.':'Still need help? Email <a href="mailto:contact@digitalallies.net">contact@digitalallies.net</a> or call <a href="tel:+19282285769">928-228-5769</a>.';r.appendChild(e)}function y(e){e.preventDefault();const n=p.querySelector('#da-q').value.trim().toLowerCase();if(!n)return o(s.faqs.slice(0,6));const f=s.faqs.filter(x=>(x.q+' '+x.a).toLowerCase().includes(n));o(f)}function L(f){l(f)}})();
